Wav2T88 - Wav→T88ファイルコンバータ
Copyright (C) 1998 Manuke


◎概要

Wav2T88はPC-8801エミュレータX88000で利用可能なカセットテープ
イメージファイル（拡張子：T88、CMT）を作成するためのツールで
す。
変換は以下のような流れで行います。

・カセットテープをサンプリングし、Wavファイルに落とす。
・Wav2T88を起動し、Wavファイルを読み込む。
・必要に応じてデータを修復／再解析。
・T88ファイルへ書き出し。

Wavファイルはサンプリング周波数11025/22050/44100/48000Hz、デ
ータビット幅8/16、チャンネル数1/2のデータに対応しています。
（圧縮形式は不可）


◎使用環境

・OS
    MS-Windows95/98/NT4
    （Win98確認しました(^^)）

・メモリ
    たくさん（笑）。
    Wavファイルサイズ×2程度あれば十分かな。
    （なくても仮想メモリが設定されていれば動作しますが、遅く
    なります）


◎画面説明

ウィンドウは上下二つのペインに分割されています。
上のペインはWavファイル全体の波形、下のペインはその一部を拡大
したものが表示されます。
Wavファイルを読み込むと、波形の背景が色分けして表示されます。
以下に各色の意味を示します。

・白
    無音部。
    （振幅が小さい、または波形の周波数が1200/2400Hzのいずれに
    も属さないと思われる部分）。

・水色
    スペース部（1200Hz）。

・黄色
    マーク部（2400Hz）。

・マゼンタ（赤紫）
    600baudデータ部。

・緑
    1200baudデータ部。

上ペインに表示されている枠は、下ペインで現在拡大されている範
囲を表しています。


◎操作説明

下のペインは縦横のスクロールバーにより拡大範囲を変更すること
ができます。

・横スクロールバー
    拡大位置を左右に移動。

・縦スクロールバー
    拡大倍率を変更。
    （上：拡大、下：縮小）

また、下ペイン内でマウスをドラッグ、もしくはShiftキーを押しな
がら左クリックすることにより、範囲選択を行うことができます。
ダブルクリックを行うと、カーソル位置のブロックを選択可能です。
範囲選択はキーボードのカーソルキーでも行えます。
左右矢印キーを単独で押すと始点を左右に移動、Ctrlキーと同時に
押すと、次のブロックまでジャンプします。
Shiftキーと同時に押すと、選択範囲を拡大／縮小できます。

「編集」メニューの操作は、この選択された部分に対してのみ実行
されます。


◎メニュー説明

○ファイル
    ・開く
        Wavファイルをオープンします。

    ・名前を付けて保存
        Wavファイルを保存します。

    ・T88書き出し
        解析結果をT88またはCMTファイルへ書き出します。
        できるだけT88形式で保存してください。
        （ローダー利用プログラムは、CMTでは読み込めない場合が
        あります）

    ・Wav2T88の終了
        Wav2T88を終了します。

○編集
    ・すべて選択
        波形全体を選択します。

    ・波形のオフセット
        選択した範囲を上／下へオフセットします。
        （正の値で上方向、負の値で下方向です）
        +100%から-100%の範囲で値を入力してください。
        ※実行後は「再解析」が必要。

    ・波形の増幅
        選択した範囲を増幅します。（単位はdB：デシベル）
        +10dBで2倍、+20dBで4倍に増幅します。
        同様に-10dBで2分の1、-20dBで4分の1に減衰します。
        +100dBから-100dBの範囲で値を入力してください。
        ※実行後は「再解析」が必要。

    ・ゼロレベル
        選択した範囲のレベルを0に設定し、波形を消去します。
        ※実行後は「再解析」が必要。

    ・センタリング
        選択した範囲の波形を上下にセンタリングします。
        低周波成分をカットする効果があります。
        ※実行後は「再解析」が必要。

    ・時間軸での伸縮
        選択した範囲を左右に伸張／縮小します。
        ※実行後は「再解析」が必要。

○解析
    ・再解析
        波形のオフセット／増幅／ゼロレベル等を実行した後、再
        度データを解析します。
        （「オープン時に解析」がオンになっているとき、Wavファ
        イルがオープンされたときに解析が行われるため、編集を
        行っていなければ実行する必要はありません）

    ・オープン時に解析
        Wavファイルをオープンしたときに自動的に解析を実行する
        かどうか指定します。
        デフォルトはオンです。

    ・周波数解析
        マーク／スペースの判別を周波数により解析します。
        （デフォルト）

    ・振幅解析
        マーク／スペースの判別を振幅により解析します。
        ※企画倒れ(笑)。認識率は最悪です。

    ・周波数+振幅解析
        マーク／スペースの判別を周波数+振幅により解析します。
        ※振幅解析のみよりはマシです(笑)。

    ・周波数認識基準の変更
        スペース（1200Hz）およびマーク（2400Hz）のキャリアを
        判定する基準を指定します。
        入力された範囲が重複している場合、重複した周波数を検
        出すると、隣の波形と比較しながら判定を行います。
        ※「再解析」を行わないと反映されません。
        （振幅解析のときは無効）

    ・振幅認識基準の変更
        スペース（1200Hz）およびマーク（2400Hz）のキャリアを
        判定する基準を指定します。
        入力された範囲が重複している場合、重複した振幅を検出
        すると、隣の波形と比較しながら判定を行います。
        ※「再解析」を行わないと反映されません。
        （周波数解析のときは無効）

    ・最大ストップビット長の変更
        ストップビットの最大の長さを指定します。
        デフォルトは2です。

○表示
    ・ツールバー
        ツールバーの表示／非表示を切り替えます。

    ・ステータスバー
        ステータスバーの表示／非表示を切り替えます。

    ・分割
        上下のペインの区切り線を移動します。

○ヘルプ
    ・バージョン情報
        Wav2T88のバージョンを表示します。


◎変換時の目安

・Wavファイルのサンプリング周波数は44100Hzが理想ですが、デー
  タ量が増えるため処理に時間がかかります。
  （特にメモリが不足している場合）
  通常のテープデータならば11025Hzで十分でしょう。

・データの前後には無音／スペース／マーク部が付随します。
  この部分はノイズを誤認して細かいパートが多数発生してしまう
  ことがあります。
  しかし、現バージョンのX88000では無音／スペース／マークは区
  別せずデータのない領域として処理するため、特に問題はありま
  せん。

・BASICプログラムはファイル名＋プログラム部の2パート、機械語
  は保存形式によって1または2パート、データファイルは1パートで
  構成されます。
  いずれもある程度の長さを有しているはずですので、短い区間で
  分断されている場合には誤認の可能性があります。

・データが分断されていても、上ペインの全体表示では細かいパー
  トが確認できない場合があり得ます。
  データが正常に読み込めないときは、下ペインでデータ部が分断
  されていないか拡大して調べてください。

・Wav2T88はノイズに弱いため、フィルタをかけられるWav編集ツー
  ルを持っている場合には低周波／高周波をカットしておくと読み
  込み精度が上がります。
  （と思う。持ってないので分かりません(^^;)）

・「センタリング」を実施すると、低周波をカットすることができ
  ます。

・解析方法として、「周波数解析」「振幅解析」「周波数+振幅解析」
  の3つのいずれかを選ぶことができます。
  …が、しかし、はっきり言って「周波数解析」以外は利用価値は
  ありません(笑)。
  解析手法は以下のようになっています。
    「周波数解析」
        波形の波長を元に判断を行います。
    「振幅解析」
        波形の振幅を元に判断を行います。
    「周波数+振幅解析」
        波長をメインに、一部振幅を見ながら判断を行います。

・一部のテープデータではストップビットが2より大きいものがある
  ようです。
  （データが黄色の帯で細かく分断される）
  この場合には、「最大ストップビット長の変更」の値を大きくす
  ると正常に認識できるようになるかもしれません。
  ただし、データを誤認してしまう可能性もありますのでご注意く
  ださい。


◎テープデータの構造

テープデータはスペースとマークの二種類のデータによって表現さ
れています。
スペースは2進数の0で、1200Hzの正弦波によって表されます。
マークは2進数の1で、2400Hzの正弦波によって表されます。
（スペースより若干振幅が小さくなります）
600baudではスペースは波形2つで1ビット、マークは波形4つで1ビッ
トを構成します。
同様に、1200baudではスペースは波形1つで1ビット、マークは波形
2つで1ビットを構成します。
テープデータは通常スタートビット1、データビット8、ストップビ
ット2の合計11ビットで1バイトを表現します。
（スタートビットは必ず0、ストップビットは必ず1です）
また、データビットはLSBから記録されます。
例えば、データ3AHは次のように表されます。

  00101110011


◎解析手法説明

PC-8801テープデータはボーレートに関わらず、1200Hzと2400Hzの二
種類の正弦波を使って表されています。
（1200Hzが0、2400Hzが1を表現します）
Wav2T88は波形がゼロレベルと交差した部分を拾っていき、その間隔
で周波数を区別します。このため、データレコーダで問題となる極
性反転したデータも正常に解析可能です。
ただし、このため低周波が乗ってしまったデータには弱くなってい
ます。データが上または下にずれてゼロレベルと交差しなくなって
しまうと解析できません。
（「センタリング」実行で、かなり改善されます）
また、振幅が極端に小さい場合にも解析できなくなります。
こうした条件に該当した場合には、波形のオフセット／増幅の処置
が必要になります。

また、Wav2T88は600baudおよび1200baudのいずれもデータビットが
8ビット、ストップビットが1.5から2ビット、パリティなしのデータ
であると想定しています。
（ストップビットの最大の長さは2〜10の範囲で変更可能）
PC-8801のシリアル転送コントローラμPD8251（Intel8251互換）は
多機能で、これ以外のデータ出力も可能です。独自のローダを使っ
たプログラムでは、これ以外のデータ形式を利用している可能性も
あります。


◎課題

・フィルタの追加（「センタリング」で半分達成か？）。
  （FFTは面倒なんですう〜(;_;)）
・より強力な解析手法。


◎更新履歴

1999-12-05 : Ver. 1, 0, 2
・「最大ストップビット長の変更」を追加
・振幅解析の追加（企画倒れ）
・インターフェースちょっと修正

1998-09-05 : Ver. 1, 0, 1
・波形センタリング／時間軸伸縮を追加。
・起動時の解析指定を追加。
・周波数認識基準の設定を付加。
・CMT形式の書き出しを追加。
・48KサンプリングWavを読み込めるよう変更。
・Wavファイル書き出しを追加。
・インターフェースを若干付加。

1998-08-10 : Ver. 1, 0, 0
・いっちゃん最初のバージョン。


◎お・や・く・そ・く

このプログラムはフリーウェアです。著作権はManukeが有するもの
とします。
ただし、このプログラムを用いたことによるいかなる損害もManuke
は補償しません。悪しからずご了承くださいませm(_ _)m。
配布は自由ですが、Manukeが提供した形態を変更しないでください。
（ファイル追加したり、一部だけ配布しないよーに）
また、バージョン統一管理のため転載はなるべく控えてください。


〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜
  へ  へ    Manuke
  の  の    E-Mail : manuke@geocities.com
〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜〜
