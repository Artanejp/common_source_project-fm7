** Qt porting and FM-7/77/AV/AV40/EX for Common Source Code Project **

                                                       September 26, 2020
                            K.Ohta  (whatisthis.sowhat _at_ gmail.com)

1.About

This package is Qt5 porting of Common Source Code Project (CSP)
and built with Qt5, for Windows, built with MinGW(32bit).

Source Code:

   https://github.com/Artanejp/common_source_project-fm7/releases/tag/SNAPSHOT_20200926
   
Additional INFO:

   Binaries will be available, distibute from osdn.net.
   
   See, https://osdn.net/projects/csp-qt/  and
        https://osdn.net/projects/csp-qt/releases/ .
	
   Released at:


2.Background

Common Source Code Project (CSP) is good emulator writing.
It also distributed with GPLv2, this is good for me.

But codes are specified to M$ Visual C.
I'm using GNU/Linux, and I starting to apply FM-7(or later).

So, I start to port to GNU/Linux and using Qt4/Qt5.

What you need at least:

a. Qt5 (neither Qt3 and Qt4) toolkit: Qt5.3 or later.

b. Some OpenGL implementation, maybe at leaset OpenGL v2.x .

c. gcc / g++ (5.0 or later? ) or llvm clang / clang++ (3.5 or later?) toolchain.

d. SDL2 (not SDL1.x).

e. CMake 2.8 or later.

f. Needs ffmpeg.See https://ffmpeg.org/ .

g. FFMpeg has bundled only for Win32.Please install for other OSs if not working.

h. Built with Qt5.5 (for Ubuntu 16.04LTS) or Qt 5.10 (for Win32 and Debian/Sid).

i. Now, changed default drawing infrastructure to OpenGL ES2.You can change --opengl option via comman line (or GUI).

j. Now for Win32 build, using LLVM CLANG cross toolchains on Docker environment.Because exception handling of MinGW-w64's gcc is very slowly (this cause by *evil* Borland).
  See https://github.com/Artanejp/llvm-mingw and https://hub.docker.com/r/artanejp/llvm-mingw64-ubuntu-cosmic for datails.
  
* TIPS: If emufoo.exe don't show screen drawing, set environment variable QT_OPENGL to software (i.e. Using Windows as VirtualBox's gueat OS).

3.How to build:

After extracting (or git pulled) sourcecodes:

$ cd {srctop}/source/build-cmake/{Machine name}/

$ mkdir build

$ cd build

To configure:

$ cmake ..

or

$ ccmake ..

To build:

$ make

To install:

$ sudo make install

4.Qt specified notice:
   
   ・Config file (scancode.cfg and foo.ini) has placed (moved) to
     "~/.config/CommonSourceCodeProject/emufoo/"
     (for Windows, ".\CommonSourceCodeProject\emudfoo\" ).
   
   ・BIOS, WAVS, BINS and SAVED STATES have placed (moved) to
     "~/CommonSourceCodeProject/emufoo/"
     (for Windows, ".\CommonSourceCodeProject\emudfoo\" ).
   
   ・All of recorded products (PNG Screenshots, MOVIES, SOUNDS) 
     have *temporally* written to "~/.config/CommonSourceCodeProject/emufoo/"
     (for Windows, ".\CommonSourceCodeProject\emudfoo\" ).
   
   ・Added ToolTips and Japanese translations.(2017-01-24)
   
   ・Place R@Ms under $HOME/CommonSourceCodeProject/emu{Machine Name}/ , this directory has made
     after first using.
   
   ・Config file, {foo}.ini is written on $HOME/.config/CommonSourceCodeProject/emu{Machine Name}/ .
   
   ・Saved state file, {foo}.sta is written on $HOME/CommonSourceCodeProject/emu{Machine Name}/ .
   
   ・Key code conversion file is written on $HOME/.config/CommonSourceCodeProject/emu{Machine Name}/scancode.cfg .
   
     This file contains comma separated fields, written at hex-decimal (not decimal), 
       first is M$ Virtual Key Code,
       second is Qt's scan code.
       
   ・Common UI components (at src/qt/gui ) are moved to shared lib. libCSPgui.so .
   
   ・Installer (bash) script is available now; src/tool/installer_unix.sh .
   
   ・When you place specified WAV files(differ per VM) same directory as ROMs, you can sound sounds: i.e. FDD seek, CMT relay and buttons.
  
5.Status

a. I tested to build only under Debian GNU/Linux "sid",Ubuntu Linux 16.04LTS "Xenial" for AMD64 (x86_64)
and MinGW with GCC6 (Windows 32bit).

   But, perhaps, will succed to build another GNU/Linux OSs or BSD OS variants.
   
   * On windows, using MinGW is already okay, but not tested drawing.
   
   * Cross building with GNU/Linux's MinGW32 and Qt5.5.1 (for MinGW) is available. 
     Modify and use build-cmake/config_build_cross_win32.sh and related *.cmake files.
     
   * And, you can also build with M$ Visual Studio 2013 or 2015.

b. Now, I using Qt5 as toolkit, because authors of Qt announced "Qt4 is obsolete, will be updated no longer".

c. All of virtual machines are already ported to Qt (On Oct 29, 2015).

d. Now using GCC-6.1 with Link Time Optimize to build for distrubuted binaries.

e. Implemented socket, networking for MZ-2500, but, not tested yet (；´Д｀)

Repositry:

   https://github.com/Artanejp/common_source_project-fm7

   https://osdn.net/projects/csp-qt/scm/git/common_source_project-fm7


Project Page:

   https://osdn.jp/projects/csp-qt/

Upstream (Takeda Toshiya San's original code):

   http://takeda-toshiya.my.coocan.jp/

Special thanks to:
   Ryu Takegami-san, to assist debugging FM-7/77/AV/40/EX .
   Haserin-san, to assist debugging FM-7/77/AV/40/EX .
   Developers of Ootake, give hints of emuPCEngine (from source code).
   Soji Yamakawa-San, author of TOWNS emulater "津軽",
                      and advice for my development a lot.  

Changes:

* To see older changes, read ChangeLog and 000_gitlog.txt.

* SNAPSHOT September 26, 2020
 * Upstream 2020-04-06.
 * [FMTOWNS/DMAC] Bootable TownsOS v1.1L30 based softwares.
                  Fix around DMA address mask.
		  See source/src/vm/fmtowns/00_status.ja.md.
 * [General] Now, version of all DLLs/SOLIBs are 3.0.x.		  
 * [DEVICE] Change API: special_reset(num).
            This aimes to support FM-Towns's multiple special resetting.
 * [I18N] Prepare to support multiple languages.
 * [Draw/GL4_5] Wait until complete to mapping.
                Fix crash with QUAZZLE (FMTOWNS;FSW Collection 10).
 * [VM/FMTOWNS][OOPs] Fix fallthroughs.
 * [VM/FMTOWNS] Add IC CARD feature.
 * [FMTOWNS/CRTC] More simple logic at rendering.
 * [FMTOWNS/CDROM] RESTORE/SEEK COMMAND (00h) must seek to lba0, then aimed lba.
 * [FMTOWNS/CDROM] PAUSE COMMAND (85h) : Return extra status even isn't audio track.
 * [FMTOWNS/CDROM] READ MODE1: May not need extra status, integrated after reading.
 * [FMTOWNS/MEMORY] Integrate memory accessing to primitive inline functions.
 * [FMTOWNS/CDROM][WIP] Status around CMD A0h. This is working-in-progress.
 * [FMTOWNS/CDROM][WIP] TRY: Implement PIO transfer.
 * [FMTOWNS/CDROM] Should read per a sector, not variable length.
 * [FMTOWNS/CDROM] Implement pseudo burst transfer for DMA.
 * [FMTOWNS/CDROM] Set CDDA_STATUS=CDDA_OFF before reading data.
                   Fix スーパーリアル麻雀PIV.
 * [FMTOWNS/SPRITE] Initially works.
 * [FMTOWNS/VRAM] Faster write access via write_memory_mapped_io[16|32]() .
 * [FMTOWNS/TIMER] Disable free run counter before 1H/2H/1F/2F.
 * [FMTOWNS/FLOPPY] Implement some bits and disk changed feature 
                    (0208h:bit0:R after Towns2H/2F/1H/1F).
 * [FMTOWNS/TIMER] Didable 1uS wait feature wait before xxF/xxH.
 * [FMTOWNS/KEYBOARD] TRY: Boot with 'CD' 'H0' etc.Still works only with 'DEBUG'.
 * [FMTOWNS/SCSI] Add SIG_SCSI_EOT signal.
 * [FMTOWNS/SCSI] Set ctr_reg after sending command to host.
 * [Qt/LOGGER] Fix not initialize (internal)osd_pointer;
               wish to fix below issue (@Fedora Linux) 
	       https://matsuri.5ch.net/test/read.cgi/i4004/1526806551/935
               by this.
 * [VM/I386_NP21] Memory access:Make functions inline to be faster processing.
 * [VM/COMMON_VM] Fix warining of 'set_context_intr' hides overloaded 
                  virtual function [-Woverloaded-virtual] with LLVM Clang++.
 * [VM/MC6809] Remove MC6809_BASE::, integrated to MC6809:: .
 * [VM/Z80] Remove Z80_BASE::, integrate to Z80:: .
 * [VM/UPD7220] Limit address of PSET.More correctness clock feature.
 * [VM/UPD71071] Fix tc bit down.
 * [VM/UPD71071] Add some signals.
 * [VM/UPD71071][FMTOWNS][MZ2800] Update API; Separate TC signals per a channel.
 * [VM/UPD71071] SREQ is prior than MASK.Don't auto transfer at demand mode.
 * [VM/UPD71071] Implement ENDx signal for stopping DMA from some devices.

 * [VM/I8259] Initialize registers by reset().
 * [EMU][UI/FLOPPY] Implement 1sec delayed open() for floppy, 
                    fix not detect when changing from HISTORY.
 * [X1/DRAW] Fix spending a lot of host CPU usage on draw_screen().
             This issue has happened at only X1 (not turbo) due to
             memory aligns and cache lines.
             Set alignment of RAM and some values.
 * Built with 97db8d7a26eb8eeb7722b009456d7c9bcadda0f7 (or later).

-- Sep 26, 2020 18:29:40 +0900 K.Ohta <whatisthis.sowhat@gmail.com>

Upstream changes:
* To see older upstream's changes, read history.txt.

4/6/2020

[VM/I386_NP21] update to Neko Project 21/W ver0.86 rev72


-----


Have fun!
-- Ohta.

