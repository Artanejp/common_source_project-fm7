** Qt porting and FM-7/77/AV/AV40/EX for Common Source Code Project **

                                                       October 28, 2018
                            K.Ohta  (whatisthis.sowhat _at_ gmail.com)

1.About

This package is Qt5 porting of Common Source Code Project (CSP)
and built with Qt5, for Windows, built with MinGW(32bit).

Source Code:

   https://github.com/Artanejp/common_source_project-fm7/releases/tag/SNAPSHOT_20181028
   
Additional INFO:

   Binaries will be available, distibute from osdn.net.
   
   See, https://osdn.net/projects/csp-qt/  and
        https://osdn.net/projects/csp-qt/releases/ .
	
   Released at:


2.Background

Common Source Code Project (CSP) is good emulator writing.
It also distributed with GPLv2, this is good for me.

But codes are specified to M$ Visual C.
I'm using GNU/Linux, and I starting to apply FM-7(or later).

So, I start to port to GNU/Linux and using Qt4/Qt5.

What you need at least:

a. Qt5 (neither Qt3 and Qt4) toolkit: Qt5.3 or later.

b. Some OpenGL implementation, maybe at leaset OpenGL v2.x .

c. gcc / g++ (5.0 or later? ) or llvm clang / clang++ (3.5 or later?) toolchain.

d. SDL2 (not SDL1.x).

e. CMake 2.8 or later.

f. Needs ffmpeg.See https://ffmpeg.org/ .

g. FFMpeg has bundled only for Win32.Please install for other OSs if not working.

h. Built with Qt5.5 (for Ubuntu 16.04LTS) or Qt 5.10 (for Win32 and Debian/Sid).

i. Now, changed default drawing infrastructure to OpenGL ES2.You can change --opengl option via comman line (or GUI).

* TIPS: If emufoo.exe don't show screen drawing, set environment variable QT_OPENGL to software (i.e. Using Windows as VirtualBox's gueat OS).


3.How to build:

After extracting (or git pulled) sourcecodes:

$ cd {srctop}/source/build-cmake/{Machine name}/

$ mkdir build

$ cd build

To configure:

$ cmake ..

or

$ ccmake ..

To build:

$ make

To install:

$ sudo make install

4.Qt specified notice:
   
   ・Config file (scancode.cfg and foo.ini) has placed (moved) to
     "~/.config/CommonSourceCodeProject/emufoo/"
     (for Windows, ".\CommonSourceCodeProject\emudfoo\" ).
   
   ・BIOS, WAVS, BINS and SAVED STATES have placed (moved) to
     "~/CommonSourceCodeProject/emufoo/"
     (for Windows, ".\CommonSourceCodeProject\emudfoo\" ).
   
   ・All of recorded products (PNG Screenshots, MOVIES, SOUNDS) 
     have *temporally* written to "~/.config/CommonSourceCodeProject/emufoo/"
     (for Windows, ".\CommonSourceCodeProject\emudfoo\" ).
   
   ・Added ToolTips and Japanese translations.(2017-01-24)
   
   ・Place R@Ms under $HOME/CommonSourceCodeProject/emu{Machine Name}/ , this directory has made
     after first using.
   
   ・Config file, {foo}.ini is written on $HOME/.config/CommonSourceCodeProject/emu{Machine Name}/ .
   
   ・Saved state file, {foo}.sta is written on $HOME/CommonSourceCodeProject/emu{Machine Name}/ .
   
   ・Key code conversion file is written on $HOME/.config/CommonSourceCodeProject/emu{Machine Name}/scancode.cfg .
   
     This file contains comma separated fields, written at hex-decimal (not decimal), 
       first is M$ Virtual Key Code,
       second is Qt's scan code.
       
   ・Common UI components (at src/qt/gui ) are moved to shared lib. libCSPgui.so .
   
   ・Installer (bash) script is available now; src/tool/installer_unix.sh .
   
   ・When you place specified WAV files(differ per VM) same directory as ROMs, you can sound sounds: i.e. FDD seek, CMT relay and buttons.
  
5.Status

a. I tested to build only under Debian GNU/Linux "sid",Ubuntu Linux 16.04LTS "Xenial" for AMD64 (x86_64)
and MinGW with GCC6 (Windows 32bit).

   But, perhaps, will succed to build another GNU/Linux OSs or BSD OS variants.
   
   * On windows, using MinGW is already okay, but not tested drawing.
   
   * Cross building with GNU/Linux's MinGW32 and Qt5.5.1 (for MinGW) is available. 
     Modify and use build-cmake/config_build_cross_win32.sh and related *.cmake files.
     
   * And, you can also build with M$ Visual Studio 2013 or 2015.

b. Now, I using Qt5 as toolkit, because authors of Qt announced "Qt4 is obsolete, will be updated no longer".

c. All of virtual machines are already ported to Qt (On Oct 29, 2015).

d. Now using GCC-6.1 with Link Time Optimize to build for distrubuted binaries.

e. Implemented socket, networking for MZ-2500, but, not tested yet (；´Д｀)

Repositry:

   https://github.com/Artanejp/common_source_project-fm7

   https://osdn.net/projects/csp-qt/scm/git/common_source_project-fm7


Project Page:

   https://osdn.jp/projects/csp-qt/

Upstream (Takeda Toshiya San's original code):

   http://takeda-toshiya.my.coocan.jp/

Special thanks to:
   Ryu Takegami-san, to assist debugging FM-7/77/AV/40/EX .
   Haserin-san, to assist debugging FM-7/77/AV/40/EX .
   
Changes:

* To see older changes, read ChangeLog and 000_gitlog.txt.

* SNAPSHOT October 28, 2018
  * Upstream 2018-10-14 .
  * Update state framework to upstream, excepts scrntype_t.
  * [VM] Use namespace {VMNAME} to separate around VMs.
  * [STATE/FILEIO] Change StateValue(scrntype_t&) to StateValueScrnType_t(&) due to compiler not detect differ of scrntipe_t and (uint32_t | uint16_t);
  * [OSD/Qt] Remove some APIs.
  * [GUI/Qt] DIALOG/ABOUT:Fix not displaying version of libOSD.
  * [GENERAL] Update gitignore.
  * [MISC/TOOL] Add function extraction script.
  * [COMMON/FILEIO] common.h : Fix pair16_t and pair64_t to fileio.cpp .
  * [COMMON/FILEIO] Re-Add FILEIO::Fflush().
  * Built with 5cdfe7e27393edaecd445ac9b315d837dd697654 (or later).

-- October 28, 2018 03:36:00 +0900 K.Ohta <whatisthis.sowhat@gmail.com>

Upstream changes:
* To see older upstream's changes, read history.txt.

10/14/2018

[COMMON/FILEIO] improve functions to load/save state file for big-endian

[VM/*] improve process_state for big-endian


10/13/2018

[EMU/DEBUGGER] increase breakpoint number from 8 to 16

[VM/VM_TEMPLATE] fix issue that virtual machine is not correctly released


10/10/2018

[VM/SCSI_DEV] fix ack signal issue when multiple devices are attached
[VM/SCSI_HOST] support to output cd/io/msg/req signals to other devices

[MZ2800/SASI] support SASI I/F and HDD (thanks Mr.Oh!Ishi)


10/7/2018

[COMMON] add pair16_t and pair64_t (thanks Mr.Artane.)
[COMMON] rename pair_t to pair32_t
[COMMON] add functions for endians (thanks Mr.Artane.)
[EMU] fix roman/kana conversion when uppercase alphabet is input (thanks Mr.Artane.)
[EMU] abolish SUPPORT_VARIABLE_TIMING and USE_TAPE_BUTTON
[WINMAIN] abolish USE_ALT_F10_KEY
[WIN32/INPUT] abolish NOTIFY_KEY_DOWN and USE_SHIFT_NUMPAD_KEY
[WIN32/INPUT] improve key input for shift + numpad keys

[VM/*] introduce VM_TEMPLATE (thanks Mr.Artane.)


10/5/2018

[COMMON] combine load_state and save_statet of cur_time_t to process_state
[COMMON/FIFO] combine load_state and save_statet to process_state
[COMMON/FILEIO] add functions to load/save state file

[VM/*] combine load_state and save_statet to process_state
[VM/I386] fix to load/save vtlb state
[VM/I386] fix to rebuild tables when load state

[JX] support save/load state
[FM77AV] import Mr.Artane.'s fixes (Release in September 30, 2018)

-----


Have fun!
-- Ohta.

