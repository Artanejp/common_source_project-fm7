** Qt porting and FM-7/77/AV/AV40/EX for Common Source Code Project **

                                                         Apr 09, 2017
                            K.Ohta  (whatisthis.sowhat _at_ gmail.com)

1.About

This package is Qt5 porting of Common Source Code Project (CSP)
and built with Qt5, for Windows, built with MinGW(32bit).

Source Code:

   https://github.com/Artanejp/common_source_project-fm7/releases/tag/SNAPSHOT_20170409
   
Additional INFO:

   Binaries will be available, distibute from osdn.net.
   
   See, https://osdn.net/projects/csp-qt/  and
        https://osdn.net/projects/csp-qt/releases/ .
	
   Released at:


2.Background

Common Source Code Project (CSP) is good emulator writing.
It also distributed with GPLv2, this is good for me.

But codes are specified to M$ Visual C.
I'm using GNU/Linux, and I starting to apply FM-7(or later).

So, I start to port to GNU/Linux and using Qt4/Qt5.

What you need at least:

a. Qt5 (neither Qt3 and Qt4) toolkit: Qt5.3 or later.

b. Some OpenGL implementation, maybe at leaset OpenGL v2.x .

c. gcc / g++ (5.0 or later? ) or llvm clang / clang++ (3.5 or later?) toolchain.

d. SDL2 (not SDL1.x).

e. CMake 2.8 or later.

* TIPS: If emufoo.exe don't show screen drawing, set environment variable QT_OPENGL to software (i.e. Using Windows as VirtualBox's gueat OS).


3.How to build:

After extracting (or git pulled) sourcecodes:

$ cd {srctop}/source/build-cmake/{Machine name}/

$ mkdir build

$ cd build

To configure:

$ cmake ..

or

$ ccmake ..

To build:

$ make

To install:

$ sudo make install

4.Qt specified notice:

*Place R@Ms under $HOME/emu{Machine Name}/ , this directory has made
after first using.

*Config file, {foo}.ini is writteon on $HOME/.config/emu{Machine Name}/ .

5.Status

a. I tested to build only under Debian GNU/Linux "sid",Ubuntu Linux 16.04LTS "Xenial" for AMD64 (x86_64)
and MinGW with GCC6 (Windows 32bit).

   But, perhaps, will succed to build another GNU/Linux OSs or BSD OS variants.
   
   * On windows, using MinGW is already okay, but not tested drawing.
   
   * Cross building with GNU/Linux's MinGW32 and Qt5.5.1 (for MinGW) is available. 
     Modify and use build-cmake/config_build_cross_win32.sh and related *.cmake files.
     
   * And, you can also build with M$ Visual Studio 2013 or 2015.

b. Now, I using Qt5 as toolkit, because authors of Qt announced "Qt4 is obsolete, will be updated no longer".

c. All of virtual machines are already ported to Qt (On Oct 29, 2015).

d. Now using GCC-6.1 with Link Time Optimize to build for distrubuted binaries.

e. Implemented socket, networking for MZ-2500, but, not tested yet (；´Д｀)

Upstream repositry:
https://github.com/Artanejp/common_source_project-fm7

Project Page:

https://osdn.jp/projects/csp-qt/

Upstream (Takeda Toshiya San's original code):

http://takeda-toshiya.my.coocan.jp/

Changes:

* SNAPSHOT April 09, 2017
  * Upstream 2017-04-02
  * [General] Add National JR-800.
  * [UI/Qt] Move drive status from status-bar to right dock.
  * [FILEIO] Fix FTBFS with ZLIB 1.2.8 or earlier.
  * [VM/General] EMU/COMMON : Fix bugs around handling filename and directories.
  * [VM/General] common.cpp : Use buffer sized functions for some string functions.
  * [VM/FM77AV] DISPLAY: HSYNC:Don't register event(s) per HDISP.
  * [VM/FM7] DISPLAY: Reduce address calculation.
  * [VM/FM7] DISPLAY: Fix auto skip feature.
  * [VM/FM7] Use function table(s) to access memories within display sub-system and main-system.
  * [VM/FM77AV40EX] Fix wrong display timing.
  * [Build/CMake] Add supporting for ZLIB.
  * [BUILD/LINUX] Fix linking order.
  * [General/BUILD] Linux: Use -D_UNICODE to build.

-- Apr 09, 2017 23:04:45 +0900 K.Ohta <whatisthis.sowhat@gmail.com>
  
* SNAPSHOT March 07, 2017
  * Upstream 2017-03-04
  * [VM] Some devices have prepared to move to libCSPcommon_vm .
  * [VM/FMGEN] Move FMGEN to libCSPfmgen .
  * [WIN32] Ready to build with DLLs contain GUI and AVIO and some features.
  * [BUILD] Selectable building.
  * [BUILD] Add logging build-status.
  * [Qt] Fix break device files when exiting emulator with some situations.
  * [Win32/OpenGL/WIP] TRY: Fixing crash with OpenGL3.0 at Corei5-2420M (and Windows7) PC. See Issues.txt or Issues.ja.txt.
  * [DOC] Update Issues.See http://hanabi.2ch.net/test/read.cgi/i4004/1483504365/30 .
  * [EMU/DEBUGGER] Use pthread_t instead of SDL_Thread.
  * [Qt/OSD] Remove do_call_debugger_command().
  * [SOUND/VM] Fix choppy sounds with some devices. i.e. PCM1BIT. Thanks to Takeda-San and Umaiboux-San.
  * [VM/FMGEN] Fix crash with GCC-5.This is issue of optimization, add "volatile" to any member(s).
  * [BUILD/LINUX] GCC5: (MAYBE) Enable to set "USE_RADICAL_OPTIMIZE" to "YES".
  * Built with 2dac70eb1743e2a0b778a57a1f520fce59aa6371 or newer.

-- Mar 07, 2017 15:55:25 +0900 K.Ohta <whatisthis.sowhat@gmail.com>

* SNAPSHOT January 30, 2017
  * Upstream 2016-12-31
  * [VM/SOUND] Fix problems voice with PCM (at least MSX and FM-7(Reviver)).
               See http://hanabi.2ch.net/test/read.cgi/i4004/1483504365/37 .
. * [VM/MB8877] Fix accessing 2D disk from 2DD mode drive (not 2D mode).
                Fixed booting issue of REVIVER for FM-7/77/AV with FM77AV40/EX/SX.
  * [Draw/Qt] Fix wrong aspect when using variable screen size.i.e.)emufm7/emufm77av40ex.
  * [UI/OpenGL] Add selection of draw infrastracture; OpenGLv3(MAIN) and OpenGLv2 (and OpenGLv3.2(Core): Still not implemented).
  * [Qt/OpenGL] Fix backgrounds not display at one-board-computer drawing with OpenGLv2.
  * [Qt/LOG] Enable syslog *truely*.
  * Built with cef2d4601438fd1fa680485ddba3434690e58451 or newer.

-- Jan 30, 2017 05:04:55 +0900 K.Ohta <whatisthis.sowhat@gmail.com>

* SNAPSHOT January 24, 2017
  * Upstream 2016-12-31
  * [UI/Qt] Add tooltips to menu entries mostly.
  * [UI/Qt] Add Japanese translations to menu entries mostly.
  * [SOUND] Add "Strict Rendering" entry to sound menu, for PCM1BIT device.
  * [VM/FM7] Fix crash without connecting FDDs.
  * [VM/UPD7752] Fix (´∀｀)＜ぬるぽ sometimes.
  * [DRAW/FM7] Fix wrong screen aspect on VMs without variable lines.
  * [Build/Linux] Fix scripts.
  * [Build/Linux] Fix crash built with gcc-5 (or earlier). Fixed for Ubuntu16.04LTS.
  * [Build/Linux] Separate builds both Debian/sid and Ubuntu/16.04LTS (expects to work with Debian/stable).
  * Built with 6e93d6920626193bf37fa6dfc2f41a8e84d8fd78 or newer.

-- Jan 24, 2017 01:06:26 +0900 K.Ohta <whatisthis.sowhat@gmail.com>

* SNAPSHOT January 06, 2017
  * Upstream 2016-12-31
  * Add Coleco Colecovision and SHARP SM-B-80TE (from upstreeam).
  * [FM7] Reduce graphic buffer for non-400 lines machines.
  * [WIN32/Qt] Cross-Build Qt libs: disable EGLFS (not EGL).
  * [Qt] One board computers: Read correctly background PNG even using indexed colors.
  * [Qt/GL] One board computers: Correctness drawing with GL3.0.
  * Built with 9bfdcc78ff194a934a2d57ce6d4f1cbec9f26a58 or newer.

-- Jan 06, 2017 19:56:37 +0900 K.Ohta <whatisthis.sowhat@gmail.com>

Upstream changes:
-----
4/2/2017

[RESOURCE] improve menu items
[WINMAIN] improve menu items

[EX80] support to show/hide crt monitor


3/30/2017

[COMMON] add functions to convert char, wchar_t, and _TCHAR to each other
[COMMON] add _fgetts, _ftprintf, my_ftprintf_s, and my_swprintf_s
[COMMON/FILEIO] add Fgetts and Ftprintf for _TCHAR
[COMMON/FILEIO] fix functions using ZLIB for _UNICODE case
[EMU/DEBUGGER] fix for _UNICODE case
[WINMAIN] improve to update status only when status is changed

[VM/HUC6280] improve disassembler to support symbols (thanks Mr.Kei Moroboshi)
[VM/I8080] improve disassembler to support symbols
[VM/M6502] support debugger and disassembler (thanks MAME)
[VM/MCS48] improve disassembler to support symbols
[VM/TMS9995] fix disassembler for _UNICODE case
[VM/UPD7810] improve disassembler to support symbols
[VM/UPD7810] fix disassembler for _UNICODE case

[BABBAGE2ND] support debugger and save/load state
[FAMILYBASIC] support debugger
[YS6464A] support debugger and save/load state


3/28/2017

[COMMON] add _tcscat and my_tcscat_s
[COMMON] add structure and functions to support symbols
[EMU/DEBUGGER] improve debugger to support symbols (thanks Mr.Kei Moroboshi)

[VM/MC6800] improve disassembler to support symbols (thanks Mr.Kei Moroboshi)
[VM/MC6809] improve disassembler to support symbols (thanks Mr.Kei Moroboshi)
[VM/TMS9995] improve disassembler to support symbols (thanks Mr.Kei Moroboshi)
[VM/UPD7801] improve disassembler to support symbols (thanks Mr.Kei Moroboshi)
[VM/Z80] improve disassembler to support symbols (thanks Mr.Kei Moroboshi)


3/26/2017

[VM/YM2413] support mute

[FAMILYBASIC] support Family BASIC MMC5/VRC7 MOD
[FAMILYBASIC] support correct scanlines
[FAMILYBASIC/MEMORY] support MMC5/ VRC7 based on unofficial nester
[FAMILYBASIC/MEMORY] fix data recorder signal (thanks MESS)


3/20/2017

[COMMON] suport to read ascii/binary file compressed by gzip
[RESOURCE] fix fm8/fm7/fm77 dipswitch menu items
[WINMAIN] fix to update status bar twice/second to supress flickar

[VM/SCSI_CDROM] support CD-ROM bin/img file compressed by gzip
[VM/DATAREC] support tape image file compressed by gzip
[VM/DATAREC] support to save FUJITSU FM-7/77 t77 format tape image

[BMJR/MEMORY] fix sound mixer not to clear previously mixed sound


3/18/2017

[WINMAIN] support multiple data recorder
[EMU] support multiple data recorder

[VM/DATAREC] support HITACH BASIC Master Jr bin format tape image
[VM/PTF20] support access lamp signal

[BMJR/MEMORY] fix reading cmt signal
[BMJR/MEMORY] fix sound mixer
[TK80BS/CMT] support TK-80 cmt i/f


3/15/2017

[WINMAIN] add status bar to draw access lamps
[EMU] add interfaces to get access status of floppy/quick/hard disk drives
[EMU] add interface to get cmt status message

[VM/DATAREC] support cmt status message
[VM/HD44102] fix build error
[VM/MC6800] fix M_RDOP and M_RDOP_ARG macros (thanks PockEmul)
[VM/LD700] support access lamp signal
[VM/SCSI_CDROM] support access lamp signal
[VM/SCSI_DEV] support access lamp signal
[VM/SCSI_HDD] support access lamp signal

[HC20] fix issue that we cannot debug TF-20 CPU
[JR800] support National JR-800 (thanks PockEmul)


3/12/2017

[VM/DATAREC] fix issue that fast forward noise may not stop


3/11/2017

[VM/DATAREC] support to play play/stop/fast-fwd noise
[VM/MB8877] support to play seek/load/unload noise
[VM/HD44102] support HD44102 based on MAME 0.171
[VM/T3444A] support to play seek/load/unload noise
[VM/UPD765A] support to play seek/load/unload noise
[VM/UPD765A] fix seek time (thanks Mr.Artane.)

[MZ80B/MEMORY80B] fix vgate signal (thanks Mr.Suga)


3/8/2017

[VM/DISK] improve to check if disk image is modified more strictly
[VM/DISK] import yaya2016-04-13plus1 (thanks Mr.umaiboux)
[VM/V9938] import yaya2016-04-13plus1 (thanks Mr.umaiboux and MAME)
[VM/YM2413] import yaya2016-04-13plus1 (thanks Mr.umaiboux)

[FMR30] split project for i86 and i286
[MSX/*] import yaya2016-04-13plus1 (thanks Mr.umaiboux)


3/7/2017

[WIN32/INPUT] improve to accept shift + caps/kana/kanji

[VM/DISK] support device name (thanks Mr.Aratane.)
[VM/EVENT] improve to check abnormal scanline number (thanks Mr.Sato)
[VM/EVENT] fix light weight sound rendering (thanks Mr.168)
[VM/*] add device name to all devices of each machine (thanks Mr.Aratane.)

[MZ80B] change floppy drive type from 2D to 2DD (thanks Mr.Suga)
[MZ80B/MEMORY80B] support I-O DATA PIO-3039 (thanks Mr.Suga)

-----


Have fun!
-- Ohta.

