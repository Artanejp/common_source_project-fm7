** Qt porting and FM-7/77/AV/AV40/EX for Common Source Code Project **

                                                       December 18, 2018
                            K.Ohta  (whatisthis.sowhat _at_ gmail.com)

1.About

This package is Qt5 porting of Common Source Code Project (CSP)
and built with Qt5, for Windows, built with MinGW(32bit).

Source Code:

   https://github.com/Artanejp/common_source_project-fm7/releases/tag/SNAPSHOT_20181218
   
Additional INFO:

   Binaries will be available, distibute from osdn.net.
   
   See, https://osdn.net/projects/csp-qt/  and
        https://osdn.net/projects/csp-qt/releases/ .
	
   Released at:


2.Background

Common Source Code Project (CSP) is good emulator writing.
It also distributed with GPLv2, this is good for me.

But codes are specified to M$ Visual C.
I'm using GNU/Linux, and I starting to apply FM-7(or later).

So, I start to port to GNU/Linux and using Qt4/Qt5.

What you need at least:

a. Qt5 (neither Qt3 and Qt4) toolkit: Qt5.3 or later.

b. Some OpenGL implementation, maybe at leaset OpenGL v2.x .

c. gcc / g++ (5.0 or later? ) or llvm clang / clang++ (3.5 or later?) toolchain.

d. SDL2 (not SDL1.x).

e. CMake 2.8 or later.

f. Needs ffmpeg.See https://ffmpeg.org/ .

g. FFMpeg has bundled only for Win32.Please install for other OSs if not working.

h. Built with Qt5.5 (for Ubuntu 16.04LTS) or Qt 5.10 (for Win32 and Debian/Sid).

i. Now, changed default drawing infrastructure to OpenGL ES2.You can change --opengl option via comman line (or GUI).

* TIPS: If emufoo.exe don't show screen drawing, set environment variable QT_OPENGL to software (i.e. Using Windows as VirtualBox's gueat OS).


3.How to build:

After extracting (or git pulled) sourcecodes:

$ cd {srctop}/source/build-cmake/{Machine name}/

$ mkdir build

$ cd build

To configure:

$ cmake ..

or

$ ccmake ..

To build:

$ make

To install:

$ sudo make install

4.Qt specified notice:
   
   ãƒ»Config file (scancode.cfg and foo.ini) has placed (moved) to
     "~/.config/CommonSourceCodeProject/emufoo/"
     (for Windows, ".\CommonSourceCodeProject\emudfoo\" ).
   
   ãƒ»BIOS, WAVS, BINS and SAVED STATES have placed (moved) to
     "~/CommonSourceCodeProject/emufoo/"
     (for Windows, ".\CommonSourceCodeProject\emudfoo\" ).
   
   ãƒ»All of recorded products (PNG Screenshots, MOVIES, SOUNDS) 
     have *temporally* written to "~/.config/CommonSourceCodeProject/emufoo/"
     (for Windows, ".\CommonSourceCodeProject\emudfoo\" ).
   
   ãƒ»Added ToolTips and Japanese translations.(2017-01-24)
   
   ãƒ»Place R@Ms under $HOME/CommonSourceCodeProject/emu{Machine Name}/ , this directory has made
     after first using.
   
   ãƒ»Config file, {foo}.ini is written on $HOME/.config/CommonSourceCodeProject/emu{Machine Name}/ .
   
   ãƒ»Saved state file, {foo}.sta is written on $HOME/CommonSourceCodeProject/emu{Machine Name}/ .
   
   ãƒ»Key code conversion file is written on $HOME/.config/CommonSourceCodeProject/emu{Machine Name}/scancode.cfg .
   
     This file contains comma separated fields, written at hex-decimal (not decimal), 
       first is M$ Virtual Key Code,
       second is Qt's scan code.
       
   ãƒ»Common UI components (at src/qt/gui ) are moved to shared lib. libCSPgui.so .
   
   ãƒ»Installer (bash) script is available now; src/tool/installer_unix.sh .
   
   ãƒ»When you place specified WAV files(differ per VM) same directory as ROMs, you can sound sounds: i.e. FDD seek, CMT relay and buttons.
  
5.Status

a. I tested to build only under Debian GNU/Linux "sid",Ubuntu Linux 16.04LTS "Xenial" for AMD64 (x86_64)
and MinGW with GCC6 (Windows 32bit).

   But, perhaps, will succed to build another GNU/Linux OSs or BSD OS variants.
   
   * On windows, using MinGW is already okay, but not tested drawing.
   
   * Cross building with GNU/Linux's MinGW32 and Qt5.5.1 (for MinGW) is available. 
     Modify and use build-cmake/config_build_cross_win32.sh and related *.cmake files.
     
   * And, you can also build with M$ Visual Studio 2013 or 2015.

b. Now, I using Qt5 as toolkit, because authors of Qt announced "Qt4 is obsolete, will be updated no longer".

c. All of virtual machines are already ported to Qt (On Oct 29, 2015).

d. Now using GCC-6.1 with Link Time Optimize to build for distrubuted binaries.

e. Implemented socket, networking for MZ-2500, but, not tested yet (ï¼›Â´Ð”ï½€)

Repositry:

   https://github.com/Artanejp/common_source_project-fm7

   https://osdn.net/projects/csp-qt/scm/git/common_source_project-fm7


Project Page:

   https://osdn.jp/projects/csp-qt/

Upstream (Takeda Toshiya San's original code):

   http://takeda-toshiya.my.coocan.jp/

Special thanks to:
   Ryu Takegami-san, to assist debugging FM-7/77/AV/40/EX .
   Haserin-san, to assist debugging FM-7/77/AV/40/EX .
   Developers of Ootake, give hints of emuPCEngine (from source code).
   
Changes:

* To see older changes, read ChangeLog and 000_gitlog.txt.

* SNAPSHOT December 18, 2018
  * Upstream 2018-12-09 .
  * [VM/PC9801] Add pseudo SASI (HDD) BIOS for PC-9801.WIP.
  * [VM/EVENT] Improve error message at cancel_event().
  * [VM/HUC2680] Improve around timer.Thanks to  Ootake v2.83.
  * [VM/PCENGINE] Improve process around NEC extended command (0xd*).
  * [VM/PCENGINE] PCE_ADPCM: Fix not sound data length >= 65536 bytes.This still don't fix some softwares.i.e. Megami-Paradise.
  * [VM/PCENGINE] Porting from Ootake v2.83.This still WORK-IN-PROGRESS.
  * [VM/PCENGINE] CDROM: Don't reset ADPCM more than once at CDROM makes "NOT BUSY".
  * [VM/PCENGINE] Most of CD-ROM^2 softwares maybe work.Excepts LASERSOFT's products and using "ARCADE card".
  * [VM/SCSI_CDROM] Add write_signal() to control CDDA from MACHINE.
  * [VM/SCSI_CDROM] Fix CD-DA buffer handling.Reading buffer should be per 2352 bytes.
  * [VM/SCSI_CDROM] CUE: More correctness cue parsing.
  * [VM/SCSI_CDROM] CUE: Set default pre-gap to 2Sec (150frames).Fix audio problems of most softwares.Maybe fixed issues on Manhole.
  * [VM/SCSI_CDROM] More correctness SEEK/Interrupt timing.
  * [VM/FM7] DISPLAY: Fix for logging "[EVENT] EVENT: device (name=DISPLAY SUBSYSTEM, id=25) tries to cancel event 6 that is not its own (owned by (name=PRINTER I/F id=20))!!!"
  * [Draw/Qt] OpenGL: Abondon depth test.
  * [UI/Qt] OOPS: Fix OOPs around mounting virtual D88/D77 image(s).
  * [UI/MENU] HARDDISK: OOPS: I missed update directory.
  * [UI/MENU] Fix oops dialog of opening virtual HDD.
  * Built with ee880845ec85aa431df3c7a937611e9c20dd591d (or later).
  
-- December 18, 2018 16:31:55 +0900 K.Ohta <whatisthis.sowhat@gmail.com>

Upstream changes:
* To see older upstream's changes, read history.txt.

12/9/2018

[VM/SCSI_CDROM] add vendor specific command for NEC CD-ROM^2

[PC8801/PC88] support CD-ROM drive (thanks M88/cdif)
[PC8801/PC88] support Video Art Boad (thanks X88000)


12/5/2018

[VM/MB8877] improve reset() to finish previous command and reset fdc completely
[VM/Z80] add read_signal() to read irq status

[PC8801/PC88] improve to render scan line with black if color graphic mode
[SMC70/MEMORY] support 640x400 and 160x100 graphic mode
[SMC777/MEMORY] fix issue that text blink is not working
[SMC777/MEMORY] improve inport 21h to read vsync irq status
[SMC777/MEMORY] improve inport 51h to read cursor and space keys as joystick #1
[VM/*] improve tape interfaces for each virtual machine


12/4/2018

[CONFIG] remove fmgen_dll_path and add mame2151_dll_path/mame2608_dll_path

[VM/YM2203] remove HAS_YM2608 and YM2203_PORT_MODE to simplify code

[PC8801] support HMB-20 sound board


12/2/2018-2

[PC8801/PC88] fix text/graph renderer again (thanks Mr.Bookworm)


12/2/2018

[PC8801/PC88] fix not to apply reverse attribute to monochrome graphic screen


12/1/2018

[PC8801] enable/disable drawing scan line when monitor type is hireso/standard
[PC8801/PC88] improve text attributes/rederer (thanks ePC-8801MA‰ü)
[PC8801/PC88] fix analog back color
[PC8801/PC88] improve routine to change palette for each scan line


11/28/2018

[WIN32/INPUT] support joystick with multiple axes and hat key
[WIN32/INPUT] improve joystick to keyboard function for numpad key 5


11/27/2018

[WIN32/INPUT] support joystick to keyboard function
[WIN32/SCREEN] support Window x1.5 mode

[PC8801/PC88] support PC key, that is mapped to F11

-----


Have fun!
-- Ohta.

