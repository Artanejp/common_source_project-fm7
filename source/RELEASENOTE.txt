** Qt porting and FM-7/77/AV/AV40/EX for Common Source Code Project **

                                                       January 05, 2020
                            K.Ohta  (whatisthis.sowhat _at_ gmail.com)

1.About

This package is Qt5 porting of Common Source Code Project (CSP)
and built with Qt5, for Windows, built with MinGW(32bit).

Source Code:

   https://github.com/Artanejp/common_source_project-fm7/releases/tag/SNAPSHOT_20200105
   
Additional INFO:

   Binaries will be available, distibute from osdn.net.
   
   See, https://osdn.net/projects/csp-qt/  and
        https://osdn.net/projects/csp-qt/releases/ .
	
   Released at:


2.Background

Common Source Code Project (CSP) is good emulator writing.
It also distributed with GPLv2, this is good for me.

But codes are specified to M$ Visual C.
I'm using GNU/Linux, and I starting to apply FM-7(or later).

So, I start to port to GNU/Linux and using Qt4/Qt5.

What you need at least:

a. Qt5 (neither Qt3 and Qt4) toolkit: Qt5.3 or later.

b. Some OpenGL implementation, maybe at leaset OpenGL v2.x .

c. gcc / g++ (5.0 or later? ) or llvm clang / clang++ (3.5 or later?) toolchain.

d. SDL2 (not SDL1.x).

e. CMake 2.8 or later.

f. Needs ffmpeg.See https://ffmpeg.org/ .

g. FFMpeg has bundled only for Win32.Please install for other OSs if not working.

h. Built with Qt5.5 (for Ubuntu 16.04LTS) or Qt 5.10 (for Win32 and Debian/Sid).

i. Now, changed default drawing infrastructure to OpenGL ES2.You can change --opengl option via comman line (or GUI).

j. Now for Win32 build, using LLVM CLANG cross toolchains on Docker environment.Because exception handling of MinGW-w64's gcc is very slowly (this cause by *evil* Borland).
  See https://github.com/Artanejp/llvm-mingw and https://hub.docker.com/r/artanejp/llvm-mingw64-ubuntu-cosmic for datails.
  
* TIPS: If emufoo.exe don't show screen drawing, set environment variable QT_OPENGL to software (i.e. Using Windows as VirtualBox's gueat OS).

3.How to build:

After extracting (or git pulled) sourcecodes:

$ cd {srctop}/source/build-cmake/{Machine name}/

$ mkdir build

$ cd build

To configure:

$ cmake ..

or

$ ccmake ..

To build:

$ make

To install:

$ sudo make install

4.Qt specified notice:
   
   ・Config file (scancode.cfg and foo.ini) has placed (moved) to
     "~/.config/CommonSourceCodeProject/emufoo/"
     (for Windows, ".\CommonSourceCodeProject\emudfoo\" ).
   
   ・BIOS, WAVS, BINS and SAVED STATES have placed (moved) to
     "~/CommonSourceCodeProject/emufoo/"
     (for Windows, ".\CommonSourceCodeProject\emudfoo\" ).
   
   ・All of recorded products (PNG Screenshots, MOVIES, SOUNDS) 
     have *temporally* written to "~/.config/CommonSourceCodeProject/emufoo/"
     (for Windows, ".\CommonSourceCodeProject\emudfoo\" ).
   
   ・Added ToolTips and Japanese translations.(2017-01-24)
   
   ・Place R@Ms under $HOME/CommonSourceCodeProject/emu{Machine Name}/ , this directory has made
     after first using.
   
   ・Config file, {foo}.ini is written on $HOME/.config/CommonSourceCodeProject/emu{Machine Name}/ .
   
   ・Saved state file, {foo}.sta is written on $HOME/CommonSourceCodeProject/emu{Machine Name}/ .
   
   ・Key code conversion file is written on $HOME/.config/CommonSourceCodeProject/emu{Machine Name}/scancode.cfg .
   
     This file contains comma separated fields, written at hex-decimal (not decimal), 
       first is M$ Virtual Key Code,
       second is Qt's scan code.
       
   ・Common UI components (at src/qt/gui ) are moved to shared lib. libCSPgui.so .
   
   ・Installer (bash) script is available now; src/tool/installer_unix.sh .
   
   ・When you place specified WAV files(differ per VM) same directory as ROMs, you can sound sounds: i.e. FDD seek, CMT relay and buttons.
  
5.Status

a. I tested to build only under Debian GNU/Linux "sid",Ubuntu Linux 16.04LTS "Xenial" for AMD64 (x86_64)
and MinGW with GCC6 (Windows 32bit).

   But, perhaps, will succed to build another GNU/Linux OSs or BSD OS variants.
   
   * On windows, using MinGW is already okay, but not tested drawing.
   
   * Cross building with GNU/Linux's MinGW32 and Qt5.5.1 (for MinGW) is available. 
     Modify and use build-cmake/config_build_cross_win32.sh and related *.cmake files.
     
   * And, you can also build with M$ Visual Studio 2013 or 2015.

b. Now, I using Qt5 as toolkit, because authors of Qt announced "Qt4 is obsolete, will be updated no longer".

c. All of virtual machines are already ported to Qt (On Oct 29, 2015).

d. Now using GCC-6.1 with Link Time Optimize to build for distrubuted binaries.

e. Implemented socket, networking for MZ-2500, but, not tested yet (；´Д｀)

Repositry:

   https://github.com/Artanejp/common_source_project-fm7

   https://osdn.net/projects/csp-qt/scm/git/common_source_project-fm7


Project Page:

   https://osdn.jp/projects/csp-qt/

Upstream (Takeda Toshiya San's original code):

   http://takeda-toshiya.my.coocan.jp/

Special thanks to:
   Ryu Takegami-san, to assist debugging FM-7/77/AV/40/EX .
   Haserin-san, to assist debugging FM-7/77/AV/40/EX .
   Developers of Ootake, give hints of emuPCEngine (from source code).
   
Changes:

* To see older changes, read ChangeLog and 000_gitlog.txt.

* SNAPSHOT Oct 15, 2019
  * Upstream 2019-04-30.
  * This is point release, still exists some issues (i.e.EMM386(NEC/PC98) and FreeBSD(98) don't work) for PC-9801 and PC-Engine and some VMs, will fix them.
  * [Tools] Add DUMP LIST CHECKER.
  * [BUILD/Win32] Build with LLVM CLANG (for MinGW-w64).Because GCC for MinGW-w64/Win32 has very slow exception handling (due to Borland's patent). 
  * [BUILD/Win32] See https://github.com/Artanejp/llvm-mingw and https://hub.docker.com/r/artanejp/llvm-mingw64-ubuntu-cosmic for datails.
  * [BUILD/Win32] Build against FFMpeg 4.2.
  * [FM7/SOUND] Fix reading value of PSG register(s).Fix sound of FM-7's demonstration with FM-7/77 (not with 77AV variants).
  * [FM7/SOUND] Separate reset sequence for OPN/WHG/THG/PSG to a common function.
  * [VM/FM7] Replace printf debug messages to out_debug_log().
  * [VM/FAMILYBASIC] WIP: Fix wrong string for romaji-kana (and auto key).Still imcoplete, implementing DAKUION,will fix.
  * [VM/PC9801] CPUREG: V30 SUB CPU works.
  * [VM/PC9801] Re-define DIPSW, to work with V30@PC-9801RA.
  * [VM/PC8801] Fix double install DEBUGGER:: for OPN#1,#2.Thanks to https://matsuri.5ch.net/test/read.cgi/i4004/1526806551/598 .
  * [VM/MC6809] Fix duplicate signal; SIG_CPU_HALT.
  * [VM/DEBUGGER] Fix FTBFSs with LLVM CLANG.
  * [VM/AY_3_891X] Fix pop noise when enabling lpf or hpf.
  * [VM/Z80DMA] OOPS: Disable debug spam.
  * [VM/Ix86] More correctness wait.
  * [VM/Ix86] Implement wait by memory-wait-factor.
  * [VM/Ix86] Add SIG_CPU_HALTREQ.
  * [VM/I386][VM/V30] Fix cloick handling when BUSREQ/HALT.
  * [VM/I8259] PC9801: Fix crash when changing V30 Sub CPU <-> i286/i386 Main CPU.
  * [VM/EVENT] Update comment of scheduler (EVENT::drive()).
  * [EMU/ROMAJI_KANA] Some characters are enabled to input via ROMAJI-KANA conversion.
  * [EMU/AUTOKEY]  Some characters are enabled to input via pasting from clipboard.This using UCS-4(aka UTF-32) internal format.
  * [Qt/OpenGL] Don't makeCurrent()/doneCurrent() inside of resizeGL().Fixed crash running within Docker container.
  * [UI/Qt] ROMAJI_KANA: Some characters input from KANA mode (by host) are enabled.
  * [UI/Qt] VM: Add keycode - vk - name table listing features.See vm/fm7/keyboard.cpp and qt/osd_base.h and gui/dialog_set_key.cpp.
  * [Qt/LOGGER] Threaded console logging.
  * [Qt/AVIO] Update FFMPEG's API: Revoke to use functions marked as deprecate.
  * [Qt/AVIO] Drop to use deprecated functions for FFMpeg 4.x.
  * [Qt/AVIO] Add some codec entries (still not implement).
  * [OSD/Qt] Update sound APIs: for sound sampling.Still be imcomplete.Will implement.
  * [OSD/SOUND] Simplify sound callback for SDL.
  * [OSD/SOUND] SDL: Convert sound rate/bitwidth.
  * [OSD/General] Fix not reply version of libvCSPosd.Display OSD version at "about this software".
  * [QT/MOVIE_LOADER] Fix weird initilaizing memory.
  * [Qt/MOVIE_SAVER] CONFIG: Some functions make dllexport.
  * [Qt/HOMEBREW] Fix not detected SDL at configuration of Qt::Gamepad.
  * [Qt/JOY_THREAD] Fix memory leak when plug/unplug joystick.
  * [UI/Qt] Add font selection to debugger and log view dialogs.
  * [UI/Qt] AUTO_KEY: Copy and paste: Paste even Zenkaku KATAKANA/HIRAGNA/ASCII to VM (converted to Hankaku letters).
  * [Qt/CONFIG] Keep font metrics and window size of debugger and log viewer.Save to foo.ini file.
  * [Qt/OpenGL] GLES: Fix texture format for float/half float.May work "TV RENDERER" with Win32 build (via ANGLE).
  * [Qt/OpenGL] Use half float texture for float textures to reduce GPU usage.
  * Built with 74c7914381802640510c76f176b3c3ffeceb678d (or later).

-- Oct 15, 2019 02:40:49 +0900 K.Ohta <whatisthis.sowhat@gmail.com>

Upstream changes:
* To see older upstream's changes, read history.txt.

12/31/2019

[MZ2500/CRTC] apply crtc patch (thanks Mr.Koucha-Youkan)

11/3/2019

[PC98RL] fix horizontal frequency

[PC98RL/DISPLAY] fix not to change horizontal frequency

[PC98RL/DISPLAY] fix cg window

[PC98RL/DISPLAY] fix multiple vram planes accessing

[PC9801/DISPLAY] fix vram word accessing (thanks Mr.Artane.)


10/28/2019

[X1/PSUB] improve tape recording

[X1/SUB] improve tape stopping

[X1/SUB] improve tape write-protected signal


10/22/2019

[X1/PSUB] improve tape end signal

[X1/SUB] improve tape end signal

-----


Have fun!
-- Ohta.

