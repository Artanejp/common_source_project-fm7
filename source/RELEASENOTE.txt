** Qt porting and FM-7/77/AV/AV40/EX for Common Source Code Project **

                                                       March 04 , 2018
                            K.Ohta  (whatisthis.sowhat _at_ gmail.com)

1.About

This package is Qt5 porting of Common Source Code Project (CSP)
and built with Qt5, for Windows, built with MinGW(32bit).

Source Code:

   https://github.com/Artanejp/common_source_project-fm7/releases/tag/SNAPSHOT_20180304
   
Additional INFO:

   Binaries will be available, distibute from osdn.net.
   
   See, https://osdn.net/projects/csp-qt/  and
        https://osdn.net/projects/csp-qt/releases/ .
	
   Released at:


2.Background

Common Source Code Project (CSP) is good emulator writing.
It also distributed with GPLv2, this is good for me.

But codes are specified to M$ Visual C.
I'm using GNU/Linux, and I starting to apply FM-7(or later).

So, I start to port to GNU/Linux and using Qt4/Qt5.

What you need at least:

a. Qt5 (neither Qt3 and Qt4) toolkit: Qt5.3 or later.

b. Some OpenGL implementation, maybe at leaset OpenGL v2.x .

c. gcc / g++ (5.0 or later? ) or llvm clang / clang++ (3.5 or later?) toolchain.

d. SDL2 (not SDL1.x).

e. CMake 2.8 or later.

* TIPS: If emufoo.exe don't show screen drawing, set environment variable QT_OPENGL to software (i.e. Using Windows as VirtualBox's gueat OS).


3.How to build:

After extracting (or git pulled) sourcecodes:

$ cd {srctop}/source/build-cmake/{Machine name}/

$ mkdir build

$ cd build

To configure:

$ cmake ..

or

$ ccmake ..

To build:

$ make

To install:

$ sudo make install

4.Qt specified notice:
   
   ・Config file (scancode.cfg and foo.ini) has placed (moved) to
     "~/.config/CommonSourceCodeProject/emufoo/"
     (for Windows, ".\CommonSourceCodeProject\emudfoo\" ).
   
   ・BIOS, WAVS, BINS and SAVED STATES have placed (moved) to
     "~/CommonSourceCodeProject/emufoo/"
     (for Windows, ".\CommonSourceCodeProject\emudfoo\" ).
   
   ・All of recorded products (PNG Screenshots, MOVIES, SOUNDS) 
     have *temporally* written to "~/.config/CommonSourceCodeProject/emufoo/"
     (for Windows, ".\CommonSourceCodeProject\emudfoo\" ).
   
   ・Added ToolTips and Japanese translations.(2017-01-24)
   
   ・Place R@Ms under $HOME/CommonSourceCodeProject/emu{Machine Name}/ , this directory has made
     after first using.
   
   ・Config file, {foo}.ini is written on $HOME/.config/CommonSourceCodeProject/emu{Machine Name}/ .
   
   ・Saved state file, {foo}.sta is written on $HOME/CommonSourceCodeProject/emu{Machine Name}/ .
   
   ・Key code conversion file is written on $HOME/.config/CommonSourceCodeProject/emu{Machine Name}/scancode.cfg .
   
     This file contains comma separated fields, written at hex-decimal (not decimal), 
       first is M$ Virtual Key Code,
       second is Qt's scan code.
       
   ・Common UI components (at src/qt/gui ) are moved to shared lib. libCSPgui.so .
   
   ・Installer (bash) script is available now; src/tool/installer_unix.sh .
   
   ・When you place specified WAV files(differ per VM) same directory as ROMs, you can sound sounds: i.e. FDD seek, CMT relay and buttons.
  
5.Status

a. I tested to build only under Debian GNU/Linux "sid",Ubuntu Linux 16.04LTS "Xenial" for AMD64 (x86_64)
and MinGW with GCC6 (Windows 32bit).

   But, perhaps, will succed to build another GNU/Linux OSs or BSD OS variants.
   
   * On windows, using MinGW is already okay, but not tested drawing.
   
   * Cross building with GNU/Linux's MinGW32 and Qt5.5.1 (for MinGW) is available. 
     Modify and use build-cmake/config_build_cross_win32.sh and related *.cmake files.
     
   * And, you can also build with M$ Visual Studio 2013 or 2015.

b. Now, I using Qt5 as toolkit, because authors of Qt announced "Qt4 is obsolete, will be updated no longer".

c. All of virtual machines are already ported to Qt (On Oct 29, 2015).

d. Now using GCC-6.1 with Link Time Optimize to build for distrubuted binaries.

e. Implemented socket, networking for MZ-2500, but, not tested yet (；´Д｀)

Repositry:

   https://github.com/Artanejp/common_source_project-fm7

   https://osdn.net/projects/csp-qt/scm/git/common_source_project-fm7


Project Page:

   https://osdn.jp/projects/csp-qt/

Upstream (Takeda Toshiya San's original code):

   http://takeda-toshiya.my.coocan.jp/

Special thanks to:
   Ryu Takegami-san, to assist debugging FM-7/77/AV/40/EX .
   Haserin-san, to assist debugging FM-7/77/AV/40/EX .
   
Changes:

* To see older changes, read ChangeLog and 000_gitlog.txt.

* SNAPSHOT Mar 04, 2018
  * Upstream 2018-03-01 .
  * Thanks to Ryu Takegami and Haserin for eFM-7/77/AV/AV40/EXand eFM8.
  * [GENERAL][EMACS] Add .dir-locals.el and vs-set-c-style.el .
  *  [UI][Qt] Fix issues for ROMAJI-TO-KANA conversion.
  * [UI][Qt][DRAW] Add drawing to separate-thread or combined.
  * [UI][Qt][DEBUGGER] Fix crash/lockup with closing debugger window.
  * [UI][Qt][DEBUGGER] Remove debugger_thread.[cpp|h] due to integrate to EMU::open_debugger() and EMU::close_debugger().
  * [Qt][WINDOWS][DEBUGGER] Fix crash when exitting emulator.
  * [Qt][Windows] Prepare to parsing command line.
  * [Qt][LOGGER] Fix locale for time-string.
  * [EMU] Remove FM-7 specific hack.
  * [OSD][Qt] Fix not setting device name to logger.
  * [OSD][Qt] Use Recursive-Mutex instead of Semaphore.
  * [EMU][Qt] Use recursive mutex to lock key-in queue.
  * [UI][Qt][FM7] Add "SYNC TO HSYNC" entry also FM-7/77/8.
  * [VM][FM7] Framerate should be 55.40fps when 400line (8colors) mode.Add supporting SUPPORT_VARIABLE_TIMING.
  * [VM][FM77] Enable to boot OS-9 L1/L2 for FM-77 with 2HD FDD.Thanks to Haserin a lot.
  * [VM][FM7] Fix FRAMERATE.Fix flicking with YS2 (/AV).
  * [VM][MC6809] Fix around extra_iclock.Maybe fix around accessing wait.
  * [VM][MC6809] Fix halt sequence.
  * [VM][MC6809] Add SIG_CPU_WAIT_FACTOR. This is setting wait factor (65536 = 1wait per clock, 0 = non wait).
                 This is ugly hack due to not permited to modify clock for CPU#0 by scheduler.
                 See FM7_MAINMEM::setclock() at vm/fm7/fm7_mainmem.cpp for details.
  * [VM][MC6809] Add correcting cpu statistics per 16 frames.
  * [VM][MB61VH010] Drop unused variables.
  * [VM][MB61VH010][WIP] Adjust sequence of BUSY flag with line.
  * [VM][MB8877] READ SECTOR: MAKE IRQ and UPDATING STATUS after reading CRC bytes.This modifying needs for FM-77 using NMI as MB8877's IRQ. Thanks to Haserin.
  * [VM][MB8877] Fix seeking sequence. Thanks to Haserin.
  * [VM][MB8877] Track-verifying may be before execute command.Thanks to Ryu Takegami.
  * [VM][MB8877] Fix wait value when end of seek and verify.Thanks to Ryu Takegami.
  * [VM][FM7][MAINMEM] More accurate wait implementation.
  * [VM][FM7][KANJIROM] Fix wrong save state.
  * [VM][FM7][DISPLAY] Not use event_vline() as determine H/V SYNC.
  * [VM][FM7][DISPLAY] Use event_frame() to kick VSTART.Not loop.
  * [VM][FM7][DISPLAY] Duplicate palette (pixel) value at VSYNC.
                       Fix rendering with DRAGON BUSTER, LUXOL and more softwares.
  * [VM][FM7][DISPLAY] Stop to use OpenMP.
                       Fix display noise at 256k colors mode on Win32 Host.
  * [VM][FM77AV40EX][DISPLAY] Don't scroll at ACTIVE_PAGE != 0.
  * [VM][FM7][KEYBOARD] Make  interupt handling at reset correctness.
                        Fix hang-up resetting after checking keyboard interrupt at mainio.
  * [VM][FM7][KEYBOARD] Fix initial key code value.
  * [VM][FM77][2HD] BREAK KEY AND ATTENTION MUST BE MASK IF FIRQ USING FOR FDC's DRQ.Thanks to Haserin.
  * [VM][PYUTA] PYUTA has no state save/load.
  * Built with 7c0c0657f8f726e7aa86ace64777036e1cca4ce4 and later.

-- Mar 04, 2018 11:22:02 +0900 K.Ohta <whatisthis.sowhat@gmail.com>

Upstream changes:
* To see older upstream's changes, read history.txt.

3/1/2018

[PC98RL] support NEC PC-98RL
[PC9801/DISPLAY] update for hireso mode
[PC9801/DISPLAY] fix for the case gdc scroll parameters are invalid
[PC9801/MEMBUS] update for hireso mode
[PC9801/MEMBUS] support outport 053Dh
[PC9801/MEMBUS] move memory map routine from VM class to MEMBUS class


2/28/2018

[VM/I286] fix not to clear cycles in reset()
[VM/I386] fix not to clear cycles in reset()
[VM/I386] improve mov_r16_rm16 instruction to check limit
[VM/I386] fix debugger

[PC9801RA] support NEC PC-9801RA


2/27/2018

[VM/I8237] fix bank register and inc mask register

[PC9801/DISPLAY] fix array length of analog palette
[PC9801/MEMBUS] improve memory bus for i386 or later (partial)


2/25/2018

[VM/DISK] improve for case 2D/2DD disk is inserted to 2DD/2D drive

[FMR30/FLOPPY] support to change drive type 2DD/2HD
[FMR30/FLOPPY] support to get media type 2D/2DD/2HD
[FMR50/BIOS] suppoert int 93h, ah=00h/01h to set/get drive type
[FMR50/BIOS] improve int 93h, ah=02h to get sector size and media type
[FMR50/FLOPPY] support to change drive type 2DD/2HD
[MZ80A] support to select floppy drive type 2D/2DD
[MZ80B] support to select floppy drive type 2D/2DD
[MZ80B] support to select cpu clock 4MHz/6MHz
[MZ800] support to select floppy drive type 2D/2DD
[MZ1500] support to select floppy drive type 2D/2DD
[MZ2200] support to select floppy drive type 2D/2DD
[MZ2200] support to select cpu clock 4MHz/6MHz
[MZ2800/FLOPPY] support to change drive type 2DD/2HD
[PC100] support to select floppy drive type 2D/2DD
[PC100/IOCTRL] improve dipswitch value for floppy drive type 2D/2DD
[X1TURBO] support to select floppy drive type 2D/2DD/2HD
[X1TURBO/FLOPPY] support to change drive type 2D/2DD/2HD


2/23/2018

[VM/DISK] support two side
[VM/I8237] support address mask
[VM/I8237] fix interface to connect tc signal for ch.2-4
[VM/IO] support to create multiple instances with different address range
[VM/MC6840] fix issue for the case address range is not 0-7
[VM/MEMORY] support to create multiple instances with different address ranges
[VM/UPD765A] fix st3 in sence devstat command

[FM16BETA] support FUJITSU FM16beta (not work)
[FMR50/MEMORY] fix memset issue
[PC9801] fix to connect terminal count signal from dmac to fdc

-----


Have fun!
-- Ohta.

